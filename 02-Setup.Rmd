---
editor_options: 
  markdown: 
    wrap: 72
  chunk_output_type: console
---

# Getting Started {#Setup2}

```{r tidyr2, echo = FALSE, message = FALSE, warning = FALSE}

library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=50), tidy = FALSE)

```

In this section, we load the packages we need, source the scripts, and
assign parameter values required for the analysis.

## Update Packages {#Setup2.1}

Some packages may require updated versions of
[R](https://www.r-project.org/) and [RStudio](https://www.rstudio.com).
To avoid errors, please ensure you are using the most recent releases of
R and RStudio, and update your R packages.

```{r update, eval = FALSE}

update.packages()                         

```

## Installing Packages {#Setup2.2}

There are a few key packages used to access, manipulate, analyse, and
create visualizations. You may find you want to upload other packages
depending on your analytical needs.

We access the NOS data using the `naturecounts` package. You can install
it from GitHub with the remotes package:

```{r install, eval = FALSE}

install.packages("naturecounts", 
                 repos = c(birdscanada = 'https://birdscanada.r-universe.dev',
                           CRAN = 'https://cloud.r-project.org'))

```

If doing the trend analyses with the R-INLA package, it can be
downloaded from the website using the following code:

```{r downloadINLA, echo = TRUE, message = FALSE}

install.packages("INLA", repos=c(getOption("repos"), INLA="https://inla.r-inla-download.org/R/stable"), dep=TRUE)
                                 
```

All the other packages are available from the CRAN repository and can be
downloaded using the **Install** button under the **Packages** tab
(bottom right window in RStudio)

```{r loadpackages1, echo = FALSE, message = FALSE}

library(naturecounts)
library(INLA)
library(tidyverse)
library(lubridate)
library(reshape)
library(ggplot2)
library(mgcv) #used for the GAM spline
library(robustHD)
library(readr)

library(RColorBrewer)
library(rgdal)
library(sp)
library(spdep)
library(sf)
library(concaveman)
library(scales)

```

## Directories {#Setup2.3}

Create a directory for analytical data and outputs. This will be placed
in your current working directory. The location of your current
directory is printed in the upper left hand corner of the RStudio
console next to the R symbol.

```{r outdir echo = FALSE, message = FALSE}

dir.create("data")
dir.create("output")

out.dir <- paste("output/")
dat.dir <- paste("data/")

```

## Analysis Parameters {#Setup2.4}

A file was created that outlines analysis parameters for various
Provinces.

**Alberta still needs assigned a protocol_id. Need to double check which
provinces have 2 listening periods in the database**

Column definitions

-   collection: each province/region has a unique collection ID

-   protocol_id: protocol vary between provinces, and some
    provinces/regions have several protocols within them. However, not
    all protocol_id are specified in this field and need to be parsed
    out using auxiliary data (e.g., BCOWLS uses the BCregions to
    differentiate protocol_id)

-   min.year: start year of survey

-   max.year: end year of survey, or set to NA if ongoing

-   temp: min temperature cut off for survey

-   min.doy: the earliest day of the year a survey should be run

-   max.doy: the latest day of the year a survey should be run

-   interval: indicates if the two minute silent listening periods is
    recorded in 1 or 2 data columns. If 2 data columns then these
    datasets are ideal for modelling the detection process

-   obs: the observation count type that should be used for the national
    analysis.

```{r load parameters echo = FALSE, message = FALSE}

#These tables are available on Github 

#Main Analysis Parameters file 
anal.param<-read.csv("Analysis Parameters.csv")
#remove sites that we don't want for the national analysis
anal.param<-anal.param %>% filter(!is.na(protocol_id)) %>% filter(protocol_id!=29)

#BC specific
BCregion<-read.csv("Regions_BCY.csv")

```
